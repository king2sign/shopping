
在线地址:
    http://www.woshipm.com/pd/1055272.html               3个方面解析：电商订单系统设计 _ 人人都是产品经理
    https://cloud.tencent.com/developer/article/1372289  电商系统设计之订单 - 云+社区 - 腾讯云
    https://cloud.tencent.com/developer/article/1340904  电商系统设计之商品 (下) - 云+社区 - 腾讯云
    http://www.sohu.com/a/211471012_468650               电商系统之订单系统
    http://www.sohu.com/a/258275003_701814               订单系统：从0到1设计思路
    https://www.sohu.com/a/221185811_114819              电商后台：实例解读订单系统
    https://www.jianshu.com/p/d1f18987525c               电商产品之订单拆分规则与流程

思想总结1
        A：订单是一个唯一标识，一般按照某种规则特定生成，设计订单号的时候要考虑到订单号生成是一种肉眼是看不出规则的 (防止竞争者或者第三方来估算订单量)
        B：订单号后续用作订单唯一标识用于对接WMS(仓库管理系统)，TMS(物流系统)
        C：订单产生的商品信息，这里除了要记录最终的金额,金额阶段也要记录。比如商品的分摊的优惠券，支付总金额，实付金额等。
           后续的订单结算、退换货、财务等环节都需要使用
        D：订单生产环节存在超时未支付订单有自动取消的过程,这个过程中订单是占用库存数的,只有订单取消后释放
        E：传统电商则是通过关联第三方物流的物流信息进行跟踪。
        F：订单产生前要判断对应的商品是否报缺,如果出现报缺就要考虑怎么处理,换货或换转推(库存，仓促调拨和退款)
           注意：报缺情况分为系统报缺和实物报缺
        G：电商系统要考虑7天无理由退换货的情景，及时订单状态完成后申请退货，此时主要涉及的金额上的计算以及一些财务程序等问题


思想总结2：
        A：订单逆向流程 解释：是指订单被取消了
                取消的情况有几种：
                            1：用户自主取消订单
                            2：风控系统触发订单
                            3：客服接到客诉仲裁后出发取消订单
                            4：超时未支付取消订单
                            5：换货报缺转为退单(取消订单)

                关注：
                     1：订单状态(在某一个订单产生后设置了某一个状态节点之后订单无法取消)
                     2：当退单被商家拒绝后需要转入客服仲裁
                     3：部分退的订单一般保持享用状态,但金额按照分摊的金额退款


思想总结3：
        A：细想下设计订单的状态和存在的价值去分析和理解他背后设计机制

        B：正向和逆向流程状态
                正向订单：    已锁定、已确认、已付款、已发货、已结算、已完成、已取消等
                正向问题单：  未确认、未锁定、未发货、部分付款、未付款等
                正向预售订单：预付款已付未确认、已确认未付尾款（变更）
                逆向退单：    待结算、未收到货、未入库、质检不通过、部分收货、已取消、客户已收货等
                逆向换单：    完成、已结算、客服已收货等

        C：服务对象维度
                客户操作的状态：待付款、待发货、待收货、待评价、买家已付款、交易成功/失败、卖家已发货、退款成功、交易关闭、

                卖家操作的状态：已锁定、已确认、已分仓、已分配、已出库、已收货、已完成等、等待买家付款、待付款和待发货订单、退款中的订单、定金已付、买家已付款、
                               卖家已发货、交易成功、交易失败、异常订单

        D：订单告知：
                当状态发生变化时,某些变化后的状态是要推送给商家或卖家的
                    告知的对象：用户、商家、物流人员
                    告知的方式：push、短信、微信、支付宝
                    推送的节点：某些状态的改变后就告知

 思想总结4：
        需求思想设计
                A：实现购买流程
                        1：实现订单的创建、发货、确认信息闭环
                        2：支持订单审核（初期可支持人工审核即可）
                        3：支持用户端显示订单相关信息
                        4：支持促销金额计算

                B：提供服务
                        1：提供订单分布式服务
                        2：支持跨平台交易单生产(即同一个大交易单内既有商家商品又有自营商品或者是多个商家的商品）
                        3：支持拆单、合并逻辑(配送单、支付单等)
                        4：提供更丰富的订单推送服务，完善订单状态

                C：支持不同营销手段下的订单类型
                        1：平台发展到足够大的规模，提效、稳定变成一个重要的话题。可以提供不同营销场景下的订单，如：团购、预购等。



 //======================3个方面解析：电商订单系统设计==============================
大致方面：订单字段、订单流程、订单推送

前奏1：电商所有模块中,订单系统作为最核心的模块,决定了某件商品的买卖流程是否能顺畅执行.起着承上启下的作用。
前奏2：很多日常开发和测试提的需求都是表面需求，而这些表面上呈现出现的各种问题，都是源自于流程上的不完整或者
       流程上某个环节的缺失导致，订单系统作为一个承上启下的模块,各个流程上出了问题,订单是逃不掉的
前奏3：为什么说订单系统是承上启下的作用，上游是什么、下游又是什么

提示：只有订单信息完善的形成后，方便与仓库拣货、包装

思想考虑1：设计订单系统需要考虑要用到那几个板块的信息，只有所有的模块都考虑清晰,才能保证订单系统的稳定性和好扩展性

           提示：一共分为5大类 商品信息、用户信息、金额信息、时间信息、订单信息
           商品信息：
                描述：商品信息属于订单系统的上游端、所有订单都是从商品演变而来、从商品到订单，订单系统必须要搜集相关的
                      商品信息。获取到的商品信息将在订单详情页面中展示
                信息内容：店铺信息、商品id、商品价格、商品规格、商品数量、商品价格、
                注意：商品金额不单单是一个商品价格所以会拿到一个独立的板块描述


           用户信息：
                描述：就是购买的人一些信息，有些平台的用户成长提醒是基于用户对平台的活跃度来计算的，列如会有会员等级及积分卡等类似的成长标识
                信息内容：用户的ID、收货人、收货地址、联系方式等
                注意：除了获取用户普通信息外，还需要获取该用户的等级，该次购买后所获得的积分，以及该用户所在等级能在该订单上扣除的优惠等信息
                目前想法：就是一些用户信息信息,目前不支持用户等级制对应的一些信息功能


           金额信息：
                描述：订单所涉及的金额信息有一定的特殊性，所以独立出来讲，理论上金额信息应归属于商品信息，但是这个金额信息有很多种。
                信息内容：商品金额、优惠金额、支付金额、
                注意：而优惠金中涉及到的信息较复杂，像有自营和第三方入驻的电商平台，后会有商家优惠和跨店优惠而这些优惠又分不同类型，
                      例如现金扣减，消费券扣减，积分获取，礼品卡扣减，或者以上几种的组合使用。
                目前想法：只有商家自己的优惠券,没有官方优惠劵


           时间信息：
              描述：记录各个卡点下的时间，一是记录、而是方便售后验证和客户分析。
              提示：订单时间是根据订单状态改变而改变的
              信息内容：
                    下单未付款：       订单创建时间、下单时间；
                    待发货状态：       订单创建时间、下单时间、支付时间；
                    待收货状态：       订单创建时间、下单时间、支付时间、发货时间；
                    交易完成状态：     订单创建时间、下单时间、下单时间、支付时间、发货时间、完成时间；
                    待退款状态：       退款订单创建时间、申请退款时间；
                    交易关闭-用户取消：订单创建时间、下单时间、用户取消时间；
                    交易关闭-仅退款：  订单创建时间、下单时间、支付时间、退款申请时间、退款成功时间；
                    交易关闭-退货退款（包含部分仅退款）：订单创建时间、下单时间、支付时间、交易完成时间、退款申请时间、退款时间。

              注意：时间信息看起来不重要，其实是订单系统一个重要的组成部分，原因大家可以思考一下。
              目前想法：这里描述的订单状态是不怎么完善的到时候会单独研究下订单系统的状态


           订单信息：
              描述：订单信息在订单系统最为核心，订单信息最重要的又是订单状态、对应一个付款方式
              信息内容：【待付款】、【待发货】、【待收货】、【待评价】、【交易完成】、【用户取消】、【仅退款】、【退货退款】
              目前想法：这里描述的订单状态是不怎么完善的到时候会单独研究下订单系统的状态
                       付款方式:目前只支持微信和支付宝付款


思想考虑2：订单流程 订单流程是指从订单产生到完成整个流程的过程，其中包括正向流程和逆向流程
     提示：
        正向流程
            描述：就是一个正常的网购步骤：订单生产--->支付订单--->卖家发货---->确认收货--->交易完成

            订单生成：用户下单后，系统需要生成订单，生成期间就要涉及订单字段信息
                     注意：订单生产后就要考虑到销售库存数量的操作，库存的扣减分为两种、
                           A：一种是下单减库存
                           B：另一种是付款减库存

                      目前想法：生成订单就扣库存,但是未支付的订单只有半个小时的时间如果超出半个小时候订单,就会自动取消订单并还原库存

            支付订单：用户支付完订单后，需要获取订单的支付信息，包括支付流水号、支付时间等
                      注意:支付完订单接着就是等商家发货，但在发货过程中，往往还有一种情况存在，很正常却也比较复杂，就是订单拆单。
                           拆单分为两种
                                A(目前不考虑)：是用户挑选的商品来自于不同渠道（自营与商家，商家与商家），此时就需要拆分订单，并分开结算，这里还涉及父子订单的说法，这里不再赘述。

                                B：另一种是在SKU层面上拆分订单：不同仓库，不同运输要求的SKU，包裹重量体积限制等因素都需要将订单拆分。
                                       描述：户提交的订单在物理上并不是一个不可拆分的单元，也即：它不是一个颗粒度最小的实体，可以进行多种形式的分解，具体如何分解根据不同的业务场景，
                                       拆分订单的原因：仓库原因、 店铺原因、跨境商品原因、 物流原因、商品品类
                                                       店铺原因：
                                                               一些电商平台（天猫、淘宝、拼多多等），有很多入驻的商家，用户的订单跨店铺结算的情况非常普遍，
                                                               那么这时候也需要对订单进行拆分，本质上这种情况和仓库有类似之处，每个入驻的商家可以看做一个仓库。

                                                       物流原因：
                                                               不同物流公司对单个包裹的重量或体积都有特殊要求，例如有些物流公司（邮政小包）规定单个包裹不能超过20kg，并且还存在一种情况：
                                                               一个10kg的包裹有可能比两个5kg的包裹收费更高，基于物流成本考虑一般也会将一个订单拆分成两个，例如申通：10罐啤酒寄到辽宁价格为24，
                                                               同样地点5瓶的价格是6块（与申通的签约价格不是市场价）。

                                                      其余到：电商产品之订单拆分规则与流程 - 简书.html页面进行查看

                                       什么时候拆单：
                                               付款前：单商家点完多个支付订单但是未支付然后去全部那里看就会出现多个订单未支付然后 一起支付
                                                       解释：只有当全部一起支付完会有一张父订单对应的多个子订单及子订单对应的信息
                                                       提示：目前父订单在支付完后买家就看不见了只能看见多个子订单信息及对应的物流信息

                                               付款后：只有商家付款之后 有商家自己设置是否要进行拆单
                                                       解释：有可能相同款式的SKU有多个商家想把这多个SKU投发到不同的快递目的就是为了省钱
                                                       提示：但是这种看来也不算是拆单吧只是提供多个物流详情信息
         逆向流程
            描述：订单的逆向流程复杂就在于它几乎能在所有的正向流程中的任何一个环节出现

            大致会出现的环节：
                取消订单
                        解释：用户提交订单时，在跳转至支付前直接退出，此时用户原则上属于取消订单，
                              因为还未付款，则比较简单，只需要将原本提交订单时扣减的库存补回即可。

                支付失败
                        解释：用户进行支付时退出，或者取消支付，我们将其列为支付失败状态，此时处理同上，将扣减的库存补回可销售库存即可。


                付款后退款
                        解释：用户支付成功后，商家还未发货，支持用户申请退款，此时如果仓库与客服是分离的，则需要先检查仓库是否已经发货，
                              若已发货则应与客户沟通是否可以收到货后再进行退款，如果仓库还未发货，
                              则可直接同意用户退款。或者企业接入菜鸟物流，实行截件功能，不过这种操作还不成熟，成本会比较大，不适合中小创业型公司。

                缺货退款
                        解释：由于商品库存不能做到100%精准(最主要的事管理不当导致的)所以信息有时候会不准确,导致
                              线上的可销售库存和实际库存不符,这时候可以与客户协商是否退狂或者让用户选择是否等待补发货


                待收货退款
                        解释：这个问题目前还没有特别完美的解决方法，商家发了货之后，用户还未收到货，此时货在路上。

                        解决(不是很完美)：
                            一种是用户收到货后重新寄回：
                                    理由：我个人倾向于这种，第一种比较灵活，因为用户未收到货就退款的原因一般与商品质量关系不大，

                            另一种是用户直接拒收包裹，包裹直接退回原地址：
                                    理由：用户可以直接拒收退回，相当于商家需要承担回退运费，而本身可能与商家并无太大关系。不推荐使用
                                          除非商家发货发错地址,这种情况由卖家承担相对应的责任

                退货退款
                        解释：用户收到货后，想要申请售后，则此时需要提供让用户输入售后原因，包括上传凭证的功能，如果与商家协商无果，还需要增加平台客服的入口，方便用户进行申诉。
                              而协商结果/申诉成功后直接触发自动退款机制，退款后触发消息通知，同时触发交易关闭状态，整个售后过程才算结束。



思考3：订单推送 订单推送的出发依赖于订单状态的改变 涉及到的信息包括：
        推送对象（用户、商家、仓库）；
        推送方式（站内消息、push、短信、微信）；
        推送节点（订单状态）。






 //======================电商后台：实例解读订单系统 ==============================
前奏1：订单所涉及到的后台系统包括用户系统、订单系统、库存系统、物流系统、评价系统
       所以订单业务的流转主要依靠完善的后台的这些子系统

订单系统信息：
        用户信息：
            用户名称、手机号、收货地址、
            提示：这些信息必须要定位到让商家可以能够完善的将货物发送到买家手上

        商品信息：
            店铺名称、商品名称、规格、价格、数量
            提示：这些信息必须要定位到让买家知道该商品是从哪个店铺购买的

        支付金额信息：
            支付总金额、商品金额、运费、运险费、优惠价格、实付金额、支付类型、支付单号(一般是第三方支付流水号)、订单号、
            提示：让商家与卖家都能够详细的看到这笔钱的支付情况

        订单状态信息：
             【待付款】、【待发货】、【待收货】、【待评价】、【交易完成】、【用户取消】、【仅退款】、【退货退款】
             提示：让主要是让卖家自己改订单处于什么个状态，对应这该状态让卖家使用不同种方式去处理不同的状态

        物流信息：
             快递单号、快递类型、物流情况信息每一个物流站点的一个情况信息描述等。
             提示：用于主要让商家和买家能够定位到该商品到底是在哪里

        时间段信息：
             订单创建时间、订单取消时间、支付时间、发货时间、收货时间、退货时间、订单完成时间等。。。
             提示：记录各个卡点下的时间，一是记录、而是方便售后验证和客户分析


//======================电商系统之订单系统  ==============================

前奏：订单系统是可以说贯穿了整个电商系统的关键流程,其他模块(用户、商品、物流、库存、支付)等都要
      围绕订单系统进行构建


订单信息：
        订单状态信息：
                 正向订单：已锁定、已确认、已付款、已发货、已结算、已完成、已取消等
                 正向问题单：  未确认、未锁定、未发货、部分付款、未付款等
                 正向预售订单：预付款已付未确认、已确认未付尾款（变更）
                 逆向退单：    待结算、未收到货、未入库、质检不通过、部分收货、已取消、客户已收货等
                 逆向换单：    完成、已结算、客服已收货等



//======================电商系统设计之商品 (下) ==============================
前奏1：在设计多商户电商情况下要考虑用户一次性下单多个商品带来的问题
       1：订单是由购物车下单.多个商品来自多个商户
       2：需要考虑到订单拆分
       3：下单时如何通知多个商家

前奏2：用户下单的时候买了多个商品对应不同的商户,我们都应该把用户一次性购买的商品信息归属与一个订单
       订单下再关联多个商品的详情。在售后操作上，也方便买家退换单个商品。




//=====================电商系统设计之订单==============================
前奏1(付款) ：正常我们都会将用户通过哪种支付方式存储到订单表中，方便查询。我想说这种做法没错，但是少了点什么，你应该有一张交易记录表，
            来记录用户发起了多少次支付，只有支付成功的时候方可记录到订单表中。这样做的优点有以下两点：
            A：订单表是比较重要的，迫不得已尽量不要操作这张表，防止出现意外，订单表除了收货发货外一般没有其他需要操作的地方。

            B：可以记录每次用户发起支付的时间，通过所谓大数据分析用户对产品的需求度和认可度，如果用户多次发起付款但取消支付，那就说明（他没钱）他可能很期望得到，
               但是因为某种原因一直在犹豫，这个时候可以针对当前用户做优惠处理，例如发一张优惠券等等。


前奏2（运输）：给用户的快递运输信息,不是实时的信息那样消耗太大,我们可以定时的去给用户展示,
            例如：
                  if(用户点击查看了){
                      从用户点击查看两小时后更新物流信息 // 这里是按照两小时来更新的，也可以拉长这个时间
                  }else{
                      每两小时更新一次物流信息
                  }
            这种频繁的更新绝对要使用nosql，当用户确认收货后再存储到mysql等数据库中。


前奏3(收货)：当用户收到货后，这其实是最难伺候的时候，用户对产品的各种不满意就可能导致退换货，
           收货操作既改变订单状态为已收货，复杂点的可能还需要im，短信，推送提醒下。
           一般都直接提醒，量大的话加入队列内处理。




//=====================订单系统：从0到1设计思路 ==============================
前奏1：在搭建企业订单系统之前,需要先梳理企业整体业务系统之间的关系和订单系统上下游关系
      只有划分清业务系统边界,才能确定订单系统的所需要那些信息及功能,进而保证各个系统之间
      高效简洁及分工明细

前奏2：订单系统是一个承上启下的作用
       上游：对应的用户信息、对应的商品 （用户需求）

       下游：用户信息、物流信息、仓库信息、商品信息、支付等(订单需求)

前奏3：
    A：订单服务主要功能是用户日常使用的服务和页面,主要订单列表、订单详情、订单操作

    B：订单逻辑就是订单系统的核心、起着至关重要的作用 在订单系统负责管理订单创建、订单支付、订单生产、订单确认、订单完成、取消订单等订单流程。
       还涉及到复杂的订单状态规则、订单金额计算规则以及增减库存规则等。

    B：底层服务 订单所需要的数据如果从各个公共服务系统调用：一是会花费大量时间、而是代码维护成本非常高，
       因此、订单系统接入所需的模块接口在订单系统中 在订单系统中一次性完成对接公共系统的服务


订单系统核心功能
      A：订单中所包含的内容信息
            物流信息：
                描述：能让商家和买家快速定位到包裹具体的位置及物流信息
                信息：物流公司、物流单号、物流状态。

            订单信息
                描述：主要能够让商家/买家知道这个订单是哪种订单(促销订单、普通订单)及对应当前订单处于什么状态(未支付、已支付、已发货等)
                信息：订单类型、订单编号、订单状态、 等

            用户信息
                描述：能够快速定位到商家发的货能够送到用户上的信息
                信息：用户账号、用户会员信息(暂时不考虑)、收货地址、优惠券信息

            产品信息
                描述：用于快速定位到某一个SPU下的一些SKU信息
                信息：SKU、数量、单价、运费、等

            支付信息
                描述：用于让商家/买家快速知道消费的详细情况
                信息：支付流水号、商品金额、运费、优惠金额、实付金额

      B：订单系统流程
            下单考虑事项：
                1:订单修改：可梳理订单内信息，根据信息关联程度及业务诉求，设定订单的可修改范围是什么，比如：客户下单后，想修改收货人地址及电话。此时只需对相应数据进行更新即可。
                2:订单取消：用户提交订单后没有进行支付操作，此时用户原则上属于取消订单，因为还未付款，则比较简单，只需要将原本提交订单时扣减的库存补回，促销优惠中使用的优惠券，权益等视平台规则，进行相应补回
                3:订单退款：用户支付成功后，客户发出退款的诉求后，需商户进行退款审核，双方达成一致后，系统应以退款单的形式完成退款，关联原订单数据。因商品无变化，所以不许考虑与库存系统的交互，仅需考虑促销系统及支付系统交互即可。
                4:订单退货：用户支付成功后，客户发出退货的诉求后，需商户进行退款审核，双方达成一致后，需对库存系统进行补回，支付系统、促销系统以退款单形式完成退款。最后，在退款/退货流程中，需结合平台业务场景，考虑优惠分摊的逻辑，在发生退款/退货时，优惠该如何退回的处理规则和流程。


            描述：流程包含正向流程及逆向流程
                  1：正向流程：
                        描述：正向流程可以比作一次顺利的网购体验过程中
                        步骤：大致=订单创建>订单支付>订单生产>订单确认>订单完成

                        增减库存规则：

                            A：支付成功才扣SPU库存
                                 优势：减少无效订单带来的资源损耗；
                                 缺点：想买但是过一会才能买当前订单生产等下付钱有可能就没有这个SKU了
                                 解决方式：
                                       A：增加提示信息：在商品详情页，订单步骤页面提示不及时付款，不能保证有库存等。


                            B：订单生产后就扣SKU库存
                                 优势：用户体验友好，系统逻辑简洁；
                                 缺点：会导致恶意下单或下单后却不买，使得真正有需求的用户无法购买，影响真实销量
                                 解决方式：
                                       A：设置订单有效时间如30分钟当前这期间是占SKU的当超时之后就自动SKU释放
                                       B：限购，用各种条件来限制买家的购买件数，比如一个账号、一个ip，只能买一件；

                            C：如果校验库存：付款前再次校验库存，如确认订单要付款时再验证一次，并友好提示用户库存不足；

                  2：逆向流程：
                         描述：逆向流程是建立在正向某个环节中产生的,逆向流程则是修改订单、取消订单、退款、退货等各种动作


      C：订单拆分：
            描述：用户支付完订单后，需要获取订单的支付信息，包括支付流水号、支付时间等。支付完订单接着就是等商家发货，
                  但在发货过程中，根据平台业务模式的不同，可能会涉及到订单的拆分。

            订单拆分一般分为两种：
                A：一种是用户挑选的商品来自于不同渠道（自营与商家，商家与商家）；
                B：另一种是在SKU层面上拆分订单：不同仓库，不同运输要求的SKU，包裹重量体积限制等因素需要将订单拆分。
















